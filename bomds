--// Taş Kağıt Makas Script (Ultimate Final) //--
local Players = game:GetService("Players")
local LocalPlayer = Players.LocalPlayer
local TextChatService = game:GetService("TextChatService")

-- UI Oluştur
local ScreenGui = Instance.new("ScreenGui")
ScreenGui.Name = "TKM_UI"
ScreenGui.Parent = LocalPlayer:WaitForChild("PlayerGui")

local Frame = Instance.new("Frame")
Frame.Size = UDim2.new(0, 250, 0, 220)
Frame.Position = UDim2.new(0.5, -125, 0.5, -110)
Frame.BackgroundColor3 = Color3.fromRGB(50, 50, 50)
Frame.BorderSizePixel = 0
Frame.Active = true
Frame.Draggable = true
Frame.Visible = true
Frame.Parent = ScreenGui

local UICorner = Instance.new("UICorner", Frame)
UICorner.CornerRadius = UDim.new(0, 12)

-- Başlık / Kapat Butonu
local TitleFrame = Instance.new("Frame")
TitleFrame.Size = UDim2.new(1, 0, 0, 30)
TitleFrame.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
TitleFrame.BorderSizePixel = 0
TitleFrame.Parent = Frame

local UICornerTitle = Instance.new("UICorner", TitleFrame)
UICornerTitle.CornerRadius = UDim.new(0, 12)

local TitleLabel = Instance.new("TextLabel")
TitleLabel.Text = "Taş Kağıt Makas"
TitleLabel.Size = UDim2.new(1, -30, 1, 0)
TitleLabel.Position = UDim2.new(0, 5, 0, 0)
TitleLabel.BackgroundTransparency = 1
TitleLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
TitleLabel.Font = Enum.Font.SourceSansBold
TitleLabel.TextSize = 18
TitleLabel.TextXAlignment = Enum.TextXAlignment.Left
TitleLabel.Parent = TitleFrame

local CloseBtn = Instance.new("TextButton")
CloseBtn.Size = UDim2.new(0, 25, 0, 25)
CloseBtn.Position = UDim2.new(1, -28, 0, 2)
CloseBtn.Text = "X"
CloseBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
CloseBtn.BackgroundColor3 = Color3.fromRGB(200, 0, 0)
CloseBtn.Font = Enum.Font.SourceSansBold
CloseBtn.TextSize = 18
CloseBtn.Parent = TitleFrame

CloseBtn.MouseButton1Click:Connect(function()
    Frame.Visible = false
end)

-- Göster Butonu
local ShowBtn = Instance.new("TextButton")
ShowBtn.Size = UDim2.new(0, 100, 0, 30)
ShowBtn.Position = UDim2.new(0, 10, 0.9, 0)
ShowBtn.Text = "Göster UI"
ShowBtn.BackgroundColor3 = Color3.fromRGB(0, 200, 0)
ShowBtn.Font = Enum.Font.SourceSansBold
ShowBtn.TextSize = 16
ShowBtn.Parent = ScreenGui

ShowBtn.MouseButton1Click:Connect(function()
    Frame.Visible = true
end)

-- TextBox (Hedef oyuncu adı)
local TargetBox = Instance.new("TextBox")
TargetBox.Size = UDim2.new(0.9, 0, 0, 30)
TargetBox.Position = UDim2.new(0.05, 0, 0.15, 0)
TargetBox.PlaceholderText = "Oyuncu adı"
TargetBox.BackgroundColor3 = Color3.fromRGB(70, 70, 70)
TargetBox.TextColor3 = Color3.fromRGB(255, 255, 255)
TargetBox.ClearTextOnFocus = false
TargetBox.Parent = Frame
local TargetCorner = Instance.new("UICorner", TargetBox)
TargetCorner.CornerRadius = UDim.new(0, 8)

-- Toggle Buton
local ToggleBtn = Instance.new("TextButton")
ToggleBtn.Size = UDim2.new(0.9, 0, 0, 30)
ToggleBtn.Position = UDim2.new(0.05, 0, 0.35, 0)
ToggleBtn.Text = "Oto TKM: Kapalı"
ToggleBtn.BackgroundColor3 = Color3.fromRGB(200,0,0)
ToggleBtn.TextColor3 = Color3.fromRGB(255,255,255)
ToggleBtn.Font = Enum.Font.SourceSansBold
ToggleBtn.TextSize = 16
ToggleBtn.Parent = Frame
local ToggleCorner = Instance.new("UICorner", ToggleBtn)
ToggleCorner.CornerRadius = UDim.new(0, 8)

local AutoEnabled = false

ToggleBtn.MouseButton1Click:Connect(function()
    AutoEnabled = not AutoEnabled
    if AutoEnabled then
        ToggleBtn.Text = "Oto TKM: Açık"
        ToggleBtn.BackgroundColor3 = Color3.fromRGB(0,200,0)
    else
        ToggleBtn.Text = "Oto TKM: Kapalı"
        ToggleBtn.BackgroundColor3 = Color3.fromRGB(200,0,0)
    end
end)

-- Manuel Butonlar
local function CreateBtn(txt, posX)
    local b = Instance.new("TextButton")
    b.Size = UDim2.new(0.28, 0, 0, 30)
    b.Position = UDim2.new(posX, 0, 0.65, 0)
    b.Text = txt
    b.BackgroundColor3 = Color3.fromRGB(80,80,80)
    b.TextColor3 = Color3.fromRGB(255,255,255)
    b.Font = Enum.Font.SourceSansBold
    b.TextSize = 16
    b.Parent = Frame
    local corner = Instance.new("UICorner", b)
    corner.CornerRadius = UDim.new(0, 8)
    return b
end

local TasBtn = CreateBtn("Taş", 0.05)
local KagitBtn = CreateBtn("Kağıt", 0.36)
local MakasBtn = CreateBtn("Makas", 0.67)

-- Chat'e mesaj yollama
local function SendChat(msg)
    if TextChatService and TextChatService.TextChannels:FindFirstChild("RBXGeneral") then
        TextChatService.TextChannels.RBXGeneral:SendAsync(msg)
    else
        warn("Chat kanalı bulunamadı!")
    end
end

TasBtn.MouseButton1Click:Connect(function() SendChat("Taş") end)
KagitBtn.MouseButton1Click:Connect(function() SendChat("Kağıt") end)
MakasBtn.MouseButton1Click:Connect(function() SendChat("Makas") end)

-- MoveMap (güncel)
local MoveMap = {
    tas = {"tas","daş","stone","kaya","t4s","d4ş"},
    kagit = {"kagit","kağıt","a4","paper","kağıd","k4git","k4g1t","kag1t"},
    makas = {"makas","makass","scissors","makaz","mks","m4kas","m4k4s","mak4s"}
}

-- Harf tekrar azaltma (ardışık harfler tekilleştir)
local function ReduceRepeats(word)
    return word:gsub("(%a)%1+", "%1")
end

-- Mesaj temizleme ve normalize etme
local function CleanAndReduce(msg)
    msg = string.lower(msg)
    msg = string.gsub(msg, "ğ","g")
    msg = string.gsub(msg, "ı","i")
    msg = string.gsub(msg, "ş","s")
    msg = string.gsub(msg, "ç","c")
    msg = string.gsub(msg, "ö","o")
    msg = string.gsub(msg, "ü","u")
    msg = string.gsub(msg, "[^%a%s]", "") -- sadece harf ve boşluk
    -- Kelime kelime harf tekrarı azalt
    local result = {}
    for w in string.gmatch(msg, "%S+") do
        table.insert(result, w:gsub("(%a)%1+", "%1"))
    end
    return result -- kelime listesi olarak döner
end

-- Rakibin hamlesini algılama
local function DetectMove(msg)
    local words = CleanAndReduce(msg)

    for _, word in ipairs(words) do
        for move, aliases in pairs(MoveMap) do
            for _, alias in ipairs(aliases) do
                if word == alias:lower() then
                    return move
                end
            end
        end
    end
    return nil
end

-- Oto TKM sistemi
TextChatService.MessageReceived:Connect(function(msg)
    if not AutoEnabled then return end
    if not msg or not msg.Text or not msg.TextSource then return end

    local sender = msg.TextSource.Name
    local message = msg.Text

    if sender == TargetBox.Text and message then
        local detected = DetectMove(message)
        if detected == "tas" then
            SendChat("Kağıt")
        elseif detected == "kagit" then
            SendChat("Makas")
        elseif detected == "makas" then
            SendChat("Taş")
        end
    end
end)
